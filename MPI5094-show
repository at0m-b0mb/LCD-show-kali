#!/bin/bash
# Source OS detection and common functions
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
source "$SCRIPT_DIR/os-detect.sh"

# Print OS information
SCRIPT_NAME=$(basename "$0")
echo "=========================================="
echo "$SCRIPT_NAME - LCD Installation"
echo "=========================================="
echo "Detected OS: $DETECTED_OS"
echo "Boot Path: $BOOT_PATH"
echo "Overlays Path: $OVERLAYS_PATH"
echo "=========================================="

sudo cp -rf ./boot/config-nomal.txt ./boot/config.txt.bak

sudo echo "dtparam=i2c_arm=on" >> ./boot/config.txt.bak
sudo echo "dtparam=spi=on" >> ./boot/config.txt.bak
sudo echo "hdmi_group=2" >> ./boot/config.txt.bak
sudo echo "hdmi_mode=87" >> ./boot/config.txt.bak
sudo echo "hdmi_cvt 800 480 60 6 0 0 0" >> ./boot/config.txt.bak
sudo echo "dtoverlay=goodix" >> ./boot/config.txt.bak
sudo cp -rf ./boot/config.txt.bak "$BOOT_PATH/config.txt"

if [ -f "$OVERLAYS_PATH/goodix.dtbo" ]; then
sudo mv "$OVERLAYS_PATH/goodix.dtbo" "$OVERLAYS_PATH/goodix.dtbo.bak"
sudo cp ./usr/goodix.dtbo "$OVERLAYS_PATH/" 
fi

sudo sync
sudo sync
sleep 1

echo "reboot now"
sudo reboot
